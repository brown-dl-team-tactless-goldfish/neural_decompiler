    int maxSumAfterPartitioning(vector<int>& A, int K) {
        vector<int> dp(A.size() + 1, 0);
        
        for(int i = 1; i <= A.size(); i++) {
            int max = A[i-1];
            for(int j = i; j > i-K && j > 0; j--) {
                max = std::max(max, A[j-1]);
                dp[i] = std::max(dp[i], max*(i-j+1) + dp[j-1]);
            }
        }
        
        return dp[A.size()];
    }