class Solution {
public:
    int countSubarrays(vector<int>& A, int k) {
        int preSum = 0, ans = 0;
        unordered_map<int, int> mp[2];
        mp[1][0] = 1;
        for(int i = 0, p = -1; i < A.size(); i++) {
            preSum  +=  A[i] > k ? 1 : A[i] < k ? -1 : 0;
            if(p < 0 && A[i] == k) p = i;
            if(p < 0) mp[i%2][preSum]++;
            else ans +=  mp[1-(p%2)][preSum-((i-p)%2)] + mp[p%2][preSum-(1-((i-p)%2))];
        }
        return ans;
    }
};