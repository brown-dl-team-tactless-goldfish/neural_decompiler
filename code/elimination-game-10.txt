
class Solution {
public:
    int lastRemaining(int n) {
      int l = 1, r = n;
      int sz = n;
      bool go_right = true;
      int step = 1;
      while (sz != 1) {
        if (go_right) {
          l += step; 
          if (sz % 2 == 1) {
            r -= step;
          }
        } else {
          r -= step; 
          if (sz % 2 == 1) {
            l += step;
          }
        } 
        go_right = !go_right; 
        sz = sz / 2;
        step *= 2;
      }
      return l;
    }
};