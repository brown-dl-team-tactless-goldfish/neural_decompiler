struct TreeNode *g_node;
int              g_depth;
int              g_level;

int tree_depth (struct TreeNode *node, int level) {
    int ld, rd, depth;
    
    if (!node) {
        return level;
    }
    
    ld = tree_depth(node->left, level + 1);
    rd = tree_depth(node->right, level + 1);
    
    depth = ld < rd ? rd : ld;
    
    if ((depth > g_depth) || (depth == g_depth && ld == rd && level < g_level)) {
        g_level = level;
        g_depth = depth;
        g_node = node;
    }
    
    return depth;
}

struct TreeNode* subtreeWithAllDeepest (struct TreeNode* root) {
    g_node = NULL;
    g_depth = -1;
    g_level = -1;
    
    tree_depth(root, 0);
    
    return g_node;
}