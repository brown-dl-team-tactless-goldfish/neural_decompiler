#define _(a,b,c) (a<(b<c?b:c)?a:(b<c?b:c))
#define __(k,t2,t3,t5) { \
    if (r[k] == r[t2]*2) t2++; \
    if (r[k] == r[t3]*3) t3++; \
    if (r[k] == r[t5]*5) t5++;}

int nthUglyNumber(int n) {
    int t2 = 0, t3 = 0, t5 = 0, k, *r = (int *)malloc(n * sizeof(int));
    for(r[0] = k = 1; k < n ; k++)
    {
        r[k] = _(r[t2]*2, r[t3]*3, r[t5]*5);
        __(k, t2, t3, t5);
    }
    return r[n-1];
}