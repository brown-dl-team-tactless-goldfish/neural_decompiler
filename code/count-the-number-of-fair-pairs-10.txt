class Solution {
public:
    long long countFairPairs(vector<int>& nums, int lower, int upper) {
        sort(nums.begin(), nums.end());
        long long res = 0;
        for(int i=0, n=nums.size(), l=n-1, r=n-1; i<n;i++, l = max(l,i)){
            while(l>i && nums[i] + nums[l] >= lower) l--;
            while(r>i && nums[i] + nums[r] > upper) r--;
            res += max(0, r-l);
        }
        return res;
    }
};