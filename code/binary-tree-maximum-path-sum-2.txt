int calcMaxPathSum(struct TreeNode* root, int* maxSum) {    
    if (root == NULL) {
        return 0;
    }
    
    int leftMax = calcMaxPathSum(root->left, maxSum);
    int rightMax = calcMaxPathSum(root->right, maxSum);

    int max = root->val;
    
    if (leftMax + root->val > max) {
        max = leftMax + root->val;
    }
    
    if (rightMax + root->val > max) {
        max = rightMax + root->val;
    }
    
    int sum = leftMax + rightMax + root->val;

    if (sum < max) {
        sum = max;
    }

    if (sum > *maxSum) {
        *maxSum = sum;
    }

    return max;
}

int maxPathSum(struct TreeNode* root){
    int maxSum = INT_MIN;
    
    calcMaxPathSum(root, &maxSum);
    
    return maxSum;
}