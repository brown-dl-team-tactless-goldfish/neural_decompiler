#define MAX_PINGS 10000
typedef struct {
  int foo;
} RecentCounter;

int pings[MAX_PINGS];
int next = 0;
int oldest = 0;

RecentCounter* recentCounterCreate() {
  // init
  next = 0;
  oldest = 0;
  // The API seems to think I need to allocate something, but
  // it doesn't actually rely on it.
  return NULL;
}

int recentCounterPing(RecentCounter* obj, int t) {
  // save this ping, update next pointer
  pings[next++] = t;
  
  // discard too-old pings
  while (t - pings[oldest] > 3000)
    oldest++;
    
  // compute and return number of recent pings
  return next - oldest;
}

void recentCounterFree(RecentCounter* rc) {
  // nothing malloc'ed, nothing to free
}