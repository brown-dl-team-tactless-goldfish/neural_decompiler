#define INTPAIR pair<int,int>

class Solution {
public:
    vector<int> rearrangeBarcodes(vector<int>& barcodes) {
        unordered_map<int,int> mp;
        for(int i:barcodes) mp[i]++;
        
        auto comp = [](INTPAIR& a,INTPAIR &b) {
            return a.second < b.second;  
        };
        
        priority_queue<INTPAIR,vector<INTPAIR>,decltype(comp)> pq(comp);
        for(auto i:mp) {
            pq.push(i);
        }
        
        vector<int> ans;
        while(!pq.empty()) {
            auto first = pq.top();
            pq.pop();
            
            if(ans.size() == 0 or ans.back() != first.first) {
                ans.push_back(first.first);
                first.second--;
                if(first.second) pq.push(first);
            } else if(!pq.empty()) {
                auto second = pq.top();
                pq.pop();
                ans.push_back(second.first);
                second.second--;
                
                if(second.second) pq.push(second);
                pq.push(first);
            }
        }
        
        return ans;
    }
};