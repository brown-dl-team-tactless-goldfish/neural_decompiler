#define MAX(x,y) ((x) > (y) ? (x): (y))

int maxPathSum_r(struct TreeNode* root, int *max){
    if(root == NULL)
        return 0;
    int lsum = maxPathSum_r(root->left, max);
    int rsum = maxPathSum_r(root->right, max);

    /* Consider the sub-tree lsum/rsum or ignore it ! */
    lsum = MAX(lsum, 0);
    rsum = MAX(rsum, 0);    

    int cur = lsum + rsum + root->val;
    *max = MAX(*max, cur);
    
    return root->val + MAX(lsum, rsum);
}
int maxPathSum(struct TreeNode* root){
    int max = INT_MIN;
    maxPathSum_r(root, &max);
    return max;
}