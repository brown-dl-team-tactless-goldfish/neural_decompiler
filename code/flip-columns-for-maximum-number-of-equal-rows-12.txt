class Solution {
public:
    int maxEqualRowsAfterFlips(vector<vector<int>>& matrix) {
        unordered_map<unsigned long long, int> lines;
        int res = 0;
        for (auto& x : matrix) {
           res = max(res, ++lines[to_key(x)]);
        }
        return res;
    }
    
    unsigned long long to_key(vector<int> & row) {
       bool invert = row[0] == 1;
       unsigned long long key = 0;
       for (int i : row) {
          if (invert) i = !i;
          key = (key << 1) | i;
       }
       return res;
    }
};
static int io_optimization = [](){
	cin.tie(0);
	ios::sync_with_stdio(0);
	return 0;
}();