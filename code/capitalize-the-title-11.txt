class Solution {
public:
    string capitalizeTitle(string title) {
        int p = -1;
        int n = title.size();
        
        for(int i = 0; i < n; i++){
            if(isalpha(title[i])) title[i] = tolower(title[i]);
            if(i == 0 || title[i - 1] == ' ') {
                p = i;
                title[i] = toupper(title[i]);
            }
            if(title[i] == ' ') {
                if(i - p < 3) title[p] = tolower(title[p]);
            }
            if(i == n - 1) {
                if(i - p + 1 < 3) title[p] = tolower(title[p]);
            }
        }
        return title;
    }
    
    char tolower(char c){
        if(c >= 'A' && c <= 'Z') return c - ('Z' - 'z');
        return c;
    }
    
    char toupper(char c){
        if(c >= 'a' && c <= 'z') return c + ('Z' - 'z');
        return c;
    }
};