void link(struct TreeLinkNode *node, struct TreeLinkNode *p)
{
    if (node == p->left && p->right)
        node->next = p->right;
    else {
        struct TreeLinkNode *next = p->next;

        while (next) {
            if (next->left) {
                node->next = next->left;
                break;
            } else if (next->right) {
                node->next = next->right;
                break;
            }
            next = next->next;
        }
    }
    if (node->right)
        link(node->right, node);
    if (node->left)
        link(node->left, node);
}

void connect(struct TreeLinkNode *root) {
    if (!root)
        return;
    if (root->right)
        link(root->right, root);
    if (root->left)
        link(root->left, root);
}