public class Solution {
    public int NumberOfArithmeticSlices(int[] nums) {
        int total = 0, n = nums.Length;
        Dictionary<long, int>[] map = new Dictionary<long, int>[n];
        for(int i = 0; i < n; i++) map[i] = new Dictionary<long, int>();
        for(int i = 1; i < n; i++){
            for(int j = 0; j < i; j++){
                long diff = (long)nums[i]-(long)nums[j];
                if(!map[j].ContainsKey(diff)) map[j].Add(diff, 0);
                if(!map[i].ContainsKey(diff)) map[i].Add(diff, 0);
                map[i][diff] += map[j][diff]+1;
                total += map[j][diff];
            }
        }
        return total;
    }
}