public class Solution {
    private bool CanDo(int[] ranks, int cars, long result) {
        foreach (int rank in ranks) 
            if ((cars -= (int) Math.Sqrt(result / rank)) <= 0)
                return true; 
        
        return false;
    }

    public long RepairCars(int[] ranks, int cars) {
        if (cars <= 0)
            return 0;

        long ever = ((long) ranks[0]) * cars * cars;
        long never = 0;

        while (ever - never > 1) {
            long middle = (ever + never) / 2;
 
            if (CanDo(ranks, cars, middle))
                ever = middle;
            else
                never = middle;     
        }
        
        return ever;
    }
}