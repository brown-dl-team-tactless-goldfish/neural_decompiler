WITH CTE AS 
(SELECT 
product_id, new_price, RANK() OVER (PARTITION BY product_id ORDER BY change_date DESC) AS rnk FROM Products WHERE change_date <= "2019-08-16" 
)

SELECT DISTINCT P.product_id, 
CASE 
WHEN C.new_price IS NULL THEN 10
ELSE C.new_price 
END AS price
FROM Products P LEFT JOIN (SELECT * FROM CTE WHERE rnk = 1) C ON P.product_id = C.product_id;