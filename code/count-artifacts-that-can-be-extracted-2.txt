class Solution {
    int dp[1001][1001]{};
    int m;
public:
    void update(int i, int j, int d) {
        for(int r = i; r <= m; r += r & -r) {
            for(int c = j; c <= m; c += c & -c) {
                dp[r][c] += d;
           }
        }
    }
    
    int get(int i, int j) {
        int sum = 0;
        for(int r = i; r > 0; r -= r & -r) {
            for(int c = j; c > 0; c -= c & -c) {
                sum += dp[r][c];
            }
        }
        return sum;
    }

    int digArtifacts(int n, vector<vector<int>>& a, vector<vector<int>>& d) {
        m = n;
        for(auto& t : d) {
            update(t[0] + 1, t[1] + 1, 1);
        }
        int res = 0;
        for(auto& t : a) {
            int lt = get(t[0], t[1]);
            int lb = get(t[2] + 1, t[1]);
            int rt = get(t[0], t[3] + 1);
            int rb = get(t[2] + 1, t[3] + 1);
            int sum = rb - rt - lb + lt;
            if(sum == (t[3] - t[1] + 1) * (t[2] - t[0] + 1)) res++;
        }
        return res;
    }
};