class Solution 
{
public:
    int unhappyFriends(int n, vector<vector<int>>& preferences, vector<vector<int>>& pairs) 
    {
        int p=pairs.size();
        map<int,int> m;
        for(int x=0; x<p; x++)
        {
            m[pairs[x][0]]=pairs[x][1];
            m[pairs[x][1]]=pairs[x][0];
        }
        int unhappy=0;
        for(int x=0; x<n; x++)
        {
            vector<int> p=preferences[x]; // 1 2 0
            int pairedWith=m[x]; // 2
            int u=0;
            for(auto it: p)
            {
                if(it==pairedWith) break;
                vector<int> p2=preferences[it]; // 3 2 0
                int pairedWith2=m[it]; // 0
                for(auto it2: p2)
                {
                    if(it2==pairedWith2) break;
                    if(it2==x)
                    {
                        u=1;
                        break;
                    }
                }
            }
            if(u) unhappy++;
        }
        return unhappy;
    }
};