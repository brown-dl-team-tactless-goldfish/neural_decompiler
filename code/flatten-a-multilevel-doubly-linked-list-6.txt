class Solution {
public:
    Node* pre = NULL;

    void DFS(Node* root) {
        if (!root) return;
        Node* c = root->child, *n = root->next;
        root->prev = pre;
        root->child = NULL;
        pre = root;
        if (c) {
            root->next = c;
            DFS(c);
            pre->next = n;
        }
        if (n) DFS430(n);
    }

    Node* flatten(Node* head) {
        DFS(head);
        return head;
    }
};