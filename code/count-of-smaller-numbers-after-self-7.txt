//AC - 20ms;
struct MyTreeNode
{
    int val, lessCount, count;
    struct MyTreeNode *left, *right;
};

typedef struct MyTreeNode TreeNode;

TreeNode* makeTreeNode(int val)
{
    TreeNode *node = (TreeNode*)malloc(sizeof(TreeNode));
    node->val = val;
    node->lessCount = 0;
    node->count = 1;
    node->left = node->right = NULL;
    return node;
}

void insert(TreeNode* root, int val, int *lessCount)
{
    int curVal = root->val;
    if(val < curVal)
    {
        root->lessCount++;
        if(NULL == root->left)
            root->left = makeTreeNode(val);
        else
            insert(root->left, val, lessCount);
    }
    else if(val > curVal)
    {
        *lessCount += root->lessCount + root->count;
        if(NULL == root->right)
            root->right = makeTreeNode(val);
        else
            insert(root->right, val, lessCount);
    }
    else
    {
        *lessCount += root->lessCount;
        root->count++;
        return ;
    }
}
int* countSmaller(int* nums, int size, int* returnSize)
{
    *returnSize = size;
    if(size == 0)
        return NULL;
    int space = sizeof(int)*size;
    int *count = (int*)malloc(space);
    memset(count, 0, space);
    TreeNode *root = makeTreeNode(nums[size-1]);
    for(int i = size-2; i > -1; i--)
        insert(root, nums[i], count+i);
    return count;
}

//AC - 24ms;
struct MyTreeNode
{
    int val, lessCount;
    struct MyTreeNode *left, *right;
};

typedef struct MyTreeNode TreeNode;

TreeNode* makeTreeNode(int val)
{
    TreeNode *node = (TreeNode*)malloc(sizeof(TreeNode));
    node->val = val;
    node->lessCount = 0;
    node->left = node->right = NULL;
    return node;
}

void insert(TreeNode* root, int val, int *lessCount)
{
    if(val < root->val)
    {
        root->lessCount++;
        if(NULL == root->left)
            root->left = makeTreeNode(val);
        else
            insert(root->left, val, lessCount);
    }
    else 
    {
        *lessCount += root->lessCount;
        if(val > root->val)
            (*lessCount)++;
        if(NULL == root->right)
            root->right = makeTreeNode(val);
        else
            insert(root->right, val, lessCount);
    }
}

int* countSmaller(int* nums, int size, int* returnSize)
{
    *returnSize = size;
    if(size == 0)
        return NULL;
    int *count = (int*)malloc(sizeof(int)*size);
    memset(count, 0, sizeof(int)*size);
    TreeNode *root = makeTreeNode(nums[size-1]);
    for(int i = size-2; i > -1; i--)
        insert(root, nums[i], count+i);
    return count;
}