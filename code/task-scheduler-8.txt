public class Solution 
{
    public int LeastInterval(char[] tasks, int n) 
    {
        Dictionary<char,int> dict = new Dictionary<char,int>();
        foreach (char c in tasks)
        {
            if (!dict.ContainsKey(c)) dict[c] = 0;
            dict[c]++;
        }
        
        int cnt = 0, idles = 0;
        while (true)
        {
            int wait = n+1;
            int dictCnt = dict.Count();
            
            foreach (var kvp in dict.OrderByDescending(x=>x.Value))
            {
                if (wait == 0) break;
                if (dict[kvp.Key] == 0) continue;
                
                dict[kvp.Key] -= 1;
                wait--;
                cnt++;
            }
            
            if (cnt == tasks.Count()) break;
            idles += wait;
        }
        
        return cnt+idles;
    }
}