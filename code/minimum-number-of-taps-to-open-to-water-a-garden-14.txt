class Solution {
public:
    int minTaps(int n, vector<int>& ranges) {
        stack<pair<int,int> > st;
        for(int i=0;i<=n;i++){
            int l = max(0,i-ranges[i]), r = min(n,i+ranges[i]);
            
            bool f = true;
            
            while(!st.empty()){
                auto [f,s] = st.top();
                if(f <= l and r <= s) {f = false; break;}
                if(l <= f and s <= r) st.pop();
                else break;
            }
            
            if(st.empty()) st.push({l,r});
            else if(f) st.push({max(l,st.top().second),r});
        }
        
        // validating stack
        int last = n, sz = st.size();
        while(st.size()){
            auto [f,s] = st.top(); st.pop();
            if(s < last) return -1;
            last = f;
        }
        return sz;
    }
};