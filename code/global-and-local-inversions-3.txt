class Solution {
public:
    using VI = vector<int>;
    using Set = set<int>;
    bool isIdealPermutation(VI& A, Set S = {}, int last = -1, int local = 0, int global = 0) {
        for (auto x: A) {
            if (x < last)
                ++local;
            global += distance(S.upper_bound(x), S.end());
            S.insert(x);
            last = x;
        }
        return local == global;
    }
};