class Solution {
public:
    vector<int> gridIllumination(int N, vector<vector<int>>& lamps, vector<vector<int>>& queries) {
        unordered_map<long long int, bool> lamps_map;
        unordered_map<int, int> row, col, left_diag, right_diag;
        vector<int> Result;
        long NN = (long)N;      //To prevent Integer overflow
        
        //Fill data in all the maps using the lamps array provided
        for(int i=0; i<lamps.size(); i++) {
            int r = lamps[i][0];
            int c = lamps[i][1];
            long int cellNo=(r*NN)+c;
            
            lamps_map[cellNo] = true;
            row[r]++;                      //Mark Row as lighted
            col[c]++;                      //Mark Col as lighted
            left_diag[r-c]++;              //Mark LeftTop->RightBottom diagonal as lighted
            right_diag[r+c]++;             //Mark RightTop->LeftBottom diagonal as lighted
        }
        
        for(int i=0;i<queries.size();i++) 
        {
            int r = queries[i][0];
            int c = queries[i][1];
            long int cellNo=(r*NN)+c;
            
            //Check if it is lighted bcoz of any itself, row, col or diagonals
            if(lamps_map[cellNo]==true || row[r]>0 || col[c]>0 || left_diag[r-c]>0 || right_diag[r+c]>0) {
                Result.push_back(1);
            }
            else {
                Result.push_back(0);
                continue;
            }
            
            //Turn off Surrounding 8 Cells if they have lamps installed on them
            int query_row=0, query_col=0;
            long query_cellNo=0;
            
            for(int j=-1; j<=1; j++) {
                for(int k=-1; k<=1; k++) {
                    query_row=r+j;
                    query_col=c+k;
                    query_cellNo=(query_row*NN)+query_col;
                    
                    //If any of the 8 cells have lamp on them...then turn it off and decrease vals form r,c & diags
                    if(lamps_map.find(query_cellNo) != lamps_map.end() && lamps_map[query_cellNo]==true) {
                        lamps_map[query_cellNo] = false;
                        row[query_row]--;
                        col[query_col]--;
                        left_diag[query_row-query_col]--;
                        right_diag[query_row+query_col]--;
                    }
                }
            }      
        }
        return Result;
    }
};