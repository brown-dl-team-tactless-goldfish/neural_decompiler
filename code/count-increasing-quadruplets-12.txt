class Solution {
public:
    long long countQuadruplets(vector<int>& nums) {
        int n=nums.size();
        vector<int> map(n+1);
        for (int i=0;i<n;i++) map[nums[i]]=i;
        vector<vector<int>> small(n, vector<int>(n+1)), large(n, vector<int>(n+1));
        for (int i=1;i<n;i++) {
            for (int j=2;j<=n;j++) small[i][j]=small[i][j-1]+(map[j-1]<i);
        }
        for (int i=n-2;i>=0;i--) {
            for (int j=n-1;j>0;j--) {
                large[i][j]=large[i][j+1]+(map[j+1]>i);
            }
        }
        long long cnt=0;
        for (int i=0;i<n;i++) {
            for (int j=i+1;j<n;j++) {
                if (nums[j]<nums[i]) {
                    cnt += small[i][nums[j]]*large[j][nums[i]];
                }
            }
        }
        return cnt;
}
};