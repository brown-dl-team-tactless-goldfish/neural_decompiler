public class Solution 
{
    public string SmallestSubsequence(string s, int k, char letter, int repetition) 
    {
        int wantedRemained = s.Count(letter.Equals);
        Stack<char> stack = new();
        int numberOfWanted = 0;
        for (int i = 0; i < s.Length; ++i) 
        {
            while (stack.Any() && stack.Peek() > s[i] && 
                   numberOfWanted + wantedRemained - NumberOfWanted(stack.Peek()) >= repetition &&
                   stack.Count() + s.Length - i > k) 
					   numberOfWanted -= NumberOfWanted(stack.Pop());
            
            if (s[i] == letter) --wantedRemained;
            
            if (stack.Count >= k || (s[i] != letter && repetition - numberOfWanted >= k - stack.Count())) continue;
			
            stack.Push(s[i]);
            if (s[i] == letter) ++numberOfWanted;
        }
        return String.Concat(stack.Reverse());
        
        int NumberOfWanted(char c) => c == letter ? 1 : 0;
    }
}