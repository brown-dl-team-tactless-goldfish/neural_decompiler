typedef enum{
    IPv4Format = 0,
    IPv6Format = 1,
    InvalidFormat = 2
}IPFormat;
#define IS_ASCII_ALPHABET(x)  (((x)>='a' && (x)<='f') || ((x)>='A' && (x)<='F'))
#define IS_ASCII_DECMIAL(x)    ((x)>='0' && (x)<='9')
inline IPFormat isIPv4Format(char * queryIP, int Len)
{
    IPFormat eReturn = 2;
    int i = 0; int iCnt = 1;
    int iOld = 0;
    char expectedDelimator, unexpectedDelimator;
    for(; i< Len; i++){
        if(queryIP[i] == ':'){ 
            expectedDelimator = ':'; unexpectedDelimator = '.';
            if(Len < 15){
                return InvalidFormat; 
            }
            eReturn = IPv6Format; break; 
        }
        else if(queryIP[i] == '.'){ 
            expectedDelimator = '.'; unexpectedDelimator = ':';
            if(Len < 7){
                return InvalidFormat; 
            }
            eReturn = IPv4Format; break; 
        }
    }

    iOld = i++;
    for(; i< Len;i++){
        if(queryIP[i] == expectedDelimator){
            iCnt ++;
            if((i-iOld == 1) || (i==Len-1)) { //previous '.' and current '.' mustn't be adj each other & must not be the last one 
                return InvalidFormat; 
            }
            iOld = i;
        }else if(queryIP[i] == unexpectedDelimator){;
            return InvalidFormat;
        } 
    }
    
    if(eReturn == IPv4Format && iCnt != 3 ) {
        eReturn = InvalidFormat;
    }else if(eReturn == IPv6Format && iCnt != 7 ) {
        eReturn = InvalidFormat;
    }
    return eReturn;
}

char * validIPAddress(char * queryIP)
{
    int iLen = strlen(queryIP);
    static char answerArr[3][8] = {{"IPv4"},{"IPv6"},{"Neither"}};
    char * ans = &answerArr[2][0]; /* assign to nothing */
    if(iLen == 0 && iLen > 39){
        return "Neither";
    }

    /* check all the '.' or ':' are valid?*/
    IPFormat ipformat = isIPv4Format(queryIP, iLen);
    if( InvalidFormat == ipformat) return "Neither";

    char delimiter[2] = {0,0};
    IPFormat State ; 
    if(ipformat == IPv4Format){
        delimiter[0] = '.'; State = IPv4Format;
    }else{
        delimiter[0] = ':'; State = IPv6Format;
    }
    char * token = strtok(queryIP,delimiter) ;
    while(token != NULL){
        int ilen = strlen(token);
        switch(State){
            case IPv4Format: 
                if((ilen > 3 ) || (token[0] == '0' && IS_ASCII_DECMIAL(token[1])) || (atoi(token) > 255)){
                    return "Neither"; /* each ip must not be greater than 3 */     /* no leading zero*/  /* must be between 0 and 255 */
                }
                for(int i=0; i<ilen; i++){  /* mustn't contain any alphabet */
                    if(IS_ASCII_DECMIAL(token[i]) == false ) return "Neither";
                }
            break;

            case IPv6Format: //for ipv6
                if(strlen(token) > 4 ) return "Neither"; /* each ip must not be greater than 4 */   
                for(int i=0; i<ilen; i++){  /* mustn't contain any alphabet */
                    if( (IS_ASCII_DECMIAL(token[i]) == false )  && (IS_ASCII_ALPHABET(token[i]) == false ) ){
                        return "Neither";
                    }
                }
            break;

            default: break;
        }
        token = strtok(NULL, delimiter);
    }
    return ((State == IPv4Format ) ? "IPv4" : "IPv6");
}