class Solution {
public:
    long long sumScores(string s) {
        int n = s.size();
        vector<int> p(n);
        int k = -1;
        p[0] = -1;
        for (int i = 1; i < n; i++) {
            while (k >= 0 && s[k + 1] != s[i]) {
                k = p[k];
            }
            if (s[k + 1] == s[i]) ++k;
            p[i] = k;
        }
        vector<long long> dp(n);
        for (int i = 1; i < n; i++) {
            if (p[i] == -1) {
                if (i > 0) {
                    dp[i] = dp[i - 1];
                }
                continue;
            }
            dp[i] = (i - p[i] == 0 ? 0 : dp[i - p[i] - 1]) + dp[p[i]] + p[i] + 1;
        }
        return dp[n - 1] + n;
    }
};