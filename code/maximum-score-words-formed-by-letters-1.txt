public int MaxScoreWords(string[] words, char[] letters, int[] score) {
	var freqs = new int[26];
	foreach (var letter in letters)
		freqs[letter - 'a']++;

	words = words.Where(w => w.ToCharArray()
		.GroupBy(c => c)
		.ToDictionary(c => c.Key, c => c.Count())
		.All(f => f.Value <= freqs[f.Key - 'a'])
	).ToArray();

	var stack = new Stack<int>();
	var max = 0;
	SubsetSearch(0);
	return max;

	void SubsetSearch(int k) {
		if (k == words.Length) {
			var chars = stack.Select(i => words[i]).SelectMany(c => c).ToArray();
			if (!chars.GroupBy(c => c).All(c => freqs[c.Key - 'a'] >= c.Count())) return;
			var points = chars.Select(c => score[c - 'a']).Sum();
			if (points > max) max = points;
		}
		else {
			stack.Push(k);
			SubsetSearch(k + 1);
			stack.Pop();
			SubsetSearch(k + 1);
		}
	}
}