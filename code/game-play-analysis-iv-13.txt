with cte (player_id, device_id, event_date, games_played, fd) as 
(select player_id, device_id, event_date, games_played, 
min(event_date) as fd 
from activity 
group by player_id) 

(select round(
(select count(distinct a.player_id) from cte c 
inner join activity a 
on c.fd = date_sub(a.event_date, interval 1 day) 
and c.player_id = a.player_id) 
/count(distinct player_id),2) as fraction 
from activity)