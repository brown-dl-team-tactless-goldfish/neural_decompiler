while (head < tail) {
    if (tn[head].tree->left) {
        tn[tail].tree = tn[head].tree->left;
        tn[tail].layer = tn[head].layer + 1;
        max_deep = fmax(max_deep, tn[tail].layer);
        tail++;
    }
    if (tn[head].tree->right) {
        tn[tail].tree = tn[head].tree->right;
        tn[tail].layer = tn[head].layer + 1;
        max_deep = fmax(max_deep, tn[tail].layer);
        tail++;
    }
    head++;
}

int ans = 0;
for (int i=0; i<head; i++) {
    if (tn[i].layer == max_deep) {
        ans += tn[i].tree->val;
    }
}
return ans;