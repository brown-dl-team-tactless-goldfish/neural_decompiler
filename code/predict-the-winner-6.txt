public class Solution 
{
    public bool PredictTheWinner(int[] nums) 
    {
        return IsWin(nums, 0, nums.Length - 1, true) >= 0;
    }

    Dictionary<string, int> keyAndScore = new Dictionary<string, int>();

    private int IsWin(int[] nums, int left, int right, bool isA)
    {
        if (left > right) return 0;

        var key = $"{left}_{right}_{isA}";

        if (keyAndScore.ContainsKey(key)) return keyAndScore[key];

        var result = 0;
        
        if (isA)
        {
            // from B
            var candidate1 = IsWin(nums, left + 1, right, !isA) + nums[left];
            var candidate2 = IsWin(nums, left, right - 1, !isA) + nums[right];

            // from B
            result = Math.Max(candidate1, candidate2);
        } 
        else
        {
            // from A
            var candidate1 = IsWin(nums, left + 1, right, !isA) - nums[left];
            var candidate2 = IsWin(nums, left, right - 1, !isA) - nums[right];

            // from A
            result = Math.Min(candidate1, candidate2);
        }

        keyAndScore[key] = result;

        return result;
    }
}