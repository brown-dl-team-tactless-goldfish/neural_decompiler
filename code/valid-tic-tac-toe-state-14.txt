class Solution {
public:
    bool validTicTacToe(vector<string>& b) {
        int x = 0, o = 0;
        for(auto& s : b) {
            for(auto c : s) {
                x += c == 'X';
                o += c == 'O';
            }
        }
        if(x < o || x - 1 > o) return false;

        bool is3x = false, is3o = false;
        for(int i = 0; i < 3; i++) {
            if(b[i][0] != ' ' && b[i][0] == b[i][1] && b[i][0] == b[i][2]) {
                if(!is3x) is3x = b[i][0] == 'X';
                if(!is3o) is3o = b[i][0] == 'O';
            }
        }

        for(int i = 0; i < 3; i++) {
            if(b[0][i] != ' ' && b[0][i] == b[1][i] && b[0][i] == b[2][i]) {
                if(!is3x) is3x = b[0][i] == 'X';
                if(!is3o) is3o = b[0][i] == 'O';
            }
        }

        if(b[0][0] != ' ' && b[0][0] == b[1][1] && b[0][0] == b[2][2]) {
            if(!is3x) is3x = b[0][0] == 'X';
            if(!is3o) is3o = b[0][0] == 'O';
        }

        if(b[0][2] != ' ' && b[0][2] == b[1][1] && b[0][2] == b[2][0]) {
            if(!is3x) is3x = b[0][2] == 'X';
            if(!is3o) is3o = b[0][2] == 'O';
        }

        if(is3x && is3o) return false;
        if(x > o && is3o) return false;
        if(x == o && is3x) return false;
        return true;
    }
};