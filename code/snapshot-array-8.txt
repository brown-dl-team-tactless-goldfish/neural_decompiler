public class SnapshotArray {
    int snapId = 0;
    Dictionary<int, int> indexAndValue = new Dictionary<int, int>();
    Dictionary<int, Dictionary<int, int>> snapIdAndIndexValue = new Dictionary<int, Dictionary<int, int>>();

    public SnapshotArray(int length) {

    }

    public void Set(int index, int val) {
        this.indexAndValue[index] = val;
    }

    public int Snap() {
        this.snapIdAndIndexValue[this.snapId] = new Dictionary<int, int>(this.indexAndValue);
        this.indexAndValue = new Dictionary<int, int>();
        var curSnapId = this.snapId;
        this.snapId++;
        return curSnapId;
    }

    public int Get(int index, int snap_id) {
        int? value = null;
        var curSnapId = snap_id;
        while (value == null && curSnapId >= 0) {
            if (this.snapIdAndIndexValue[curSnapId].ContainsKey(index)) {
                value = this.snapIdAndIndexValue[curSnapId][index];
            }
            curSnapId--;
        }

        return !value.HasValue ? 0 : value.Value;
    }
}