public class Solution {
    public int ThreeSumMulti(int[] arr, int target) {
        
        if(arr == null || arr.Length < 3)
            throw new ArgumentException("Invalid Input.");
        
        Dictionary<int,long> dic = new Dictionary<int,long>();
        foreach(var num in arr)
        {
            dic[num] = dic.GetValueOrDefault(num,0) + 1;
        }
        
        int modulo = (int)1e9 + 7;
        long res = 0;
        foreach(var num1 in dic.Keys)
        {
            foreach(var num2 in dic.Keys)
            {
                int num3 = target - num1 - num2;
               
                if(dic.ContainsKey(num3))
                {
                    long cnt1 = dic[num1];
                    long cnt2 = dic[num2];
                    long cnt3 = dic[num3];;
                   
                    if(num1 == num2 && num1 == num3)
                        res += cnt1 *(cnt1 - 1)* (cnt1 - 2) / 6;
                    else if(num1 == num3 && num1 != num2)
                        res += cnt1 * (cnt1 - 1) / 2 * cnt2;  
                    else if(num1 < num2 && num2 < num3)
                        res += cnt1* cnt2 * cnt3;
                    
                    res = res % modulo;
                }
            }
        }
        return (int)res;
    }
}