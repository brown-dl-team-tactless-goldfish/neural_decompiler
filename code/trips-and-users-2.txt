
select Request_at as [Day], CAST(cancelledRequestsForDay/totalRequestsForDay AS DECIMAL(19,2)) as [Cancellation Rate] from 
(
	select	 Request_at
			,CAST(SUM(CASE WHEN t.[Status] <> 'completed' THEN 1 ELSE 0 END) as DECIMAL(19,2)) as cancelledRequestsForDay
			,CAST(count(*) as DECIMAL(19,2)) as totalRequestsForDay
	from	Trips t join 
			users c on t.Client_Id = c.Users_Id and c.Banned <> 'Yes' join
			users d on t.Driver_Id = d.Users_Id and d.Banned <> 'Yes'
	where Request_at between '2013-10-01' and '2013-10-03' 
	group by Request_at
) as t1
