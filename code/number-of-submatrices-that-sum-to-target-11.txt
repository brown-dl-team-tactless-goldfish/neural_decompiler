class Solution {
public:
    int numSubmatrixSumTarget(vector<vector<int>>& m, int tar){
        int i, j, r = m.size(), c = m[0].size(), ans = 0;
        
        for(i=1;i<r;i++)
            for(j=0;j<c;j++)
                m[i][j] += m[i-1][j];
        
        for(i=0;i<r;i++)
            for(j=0;j<c;j++){
                if(j)
                    m[i][j] += m[i][j-1];
                
                for(int k = j-1;k>=-1;k--){
                    for(int l=i-1;l>=-1;l--){
                        int left, up, diag;
                        if(k<0)
                            left = 0;
                        else
                            left = m[i][k];
                        if(l<0)
                            up = 0;
                        else
                            up = m[l][j];
                        
                        if(l < 0 || k<0)
                            diag = 0;
                        else
                            diag = m[l][k];
                        
                        int curr = m[i][j] - left - up + diag;
                        if(curr == tar)
                            ans++;
                    }
                }       
            }
        return ans;
    }
};