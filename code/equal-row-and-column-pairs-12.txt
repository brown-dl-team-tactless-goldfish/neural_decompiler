class Solution {
public:
  int equalPairs(vector<vector<int>>& grid) {
    vector<int> rows(grid.size(), 0), cols(grid.size(), 0);
    
    int ans = 0;
    for(int i = 0; i != grid.size(); i++)
      if(!rows[i]){
        rows[i] = 1;
        int val_r = 1;
        
        for(int r = i + 1; r != grid.size(); r++)
          if(!rows[r]){
            for(int j = 0; j != grid.size(); j++)
              if(grid[i][j] != grid[r][j]) goto mark;
            rows[r] = 1;
            val_r++;
                
            mark:;
          }
        
        int val_c = 0;
        for(int j = 0; j != grid.size(); j++)
          if(!cols[j]){
            for(int k = 0; k != grid.size(); k++)
              if(grid[i][k] != grid[k][j]) goto mark2;
            cols[j] = 1;
            val_c++;
                
            mark2:;
          }
        
        ans += val_r * val_c;
      }
    
    return ans;
  }
};