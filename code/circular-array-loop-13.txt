class Solution {
public:
    bool circularArrayLoop(vector<int>& nums) {
        int size{(int)nums.size()};
        std::vector<int> visited(size, -1);
        for(int i{0}; i < size; ++i) {
            if(check(nums, visited, i, nums[i] > 0)) return true;
        }
        
        return false;
    }
    
    bool check(std::vector<int>& nums, std::vector<int>& visited, int i, bool pos) {

        if(pos && nums[i] < 0 || !pos && nums[i] > 0 || visited[i] == 0) return false;
        if(visited[i] == 1) return true;
        
        int size{(int)nums.size()};
        if(std::abs(nums[i])%size == 0) {
            visited[i] = 0;
            return false;
        }
        
        visited[i] = 1;
        bool res{false};
        
        if(nums[i] > 0) res = check(nums, visited, (i+nums[i])%size, pos);
        else res = check(nums, visited, (i+size+(nums[i]%size))%size, pos);
        
        if(!res) visited[i] = 0;
        return res;
    }
};