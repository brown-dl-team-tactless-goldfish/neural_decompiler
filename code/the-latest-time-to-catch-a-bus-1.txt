class Solution {
public:
    int lessThan(int x, set<int> &s)
    {
        while(s.find(x) != s.end())  x--;
        return x;
    }
    int latestTimeCatchTheBus(vector<int>& b, vector<int>& p, int capacity) {
        sort(b.begin(), b.end());
        sort(p.begin(), p.end());
        set<int> s(p.begin(), p.end());
        int j=0, c = 0;
        
        for(int i=0; (i<p.size()) && (j<b.size()); i++)
        {
            if(p[i] <= b[j]) c++;
            else
            {
                j++;  i--;
                c = 0;
            }
            if( (j == b.size()-1) && (c == capacity) )
                return lessThan(p[i], s);
            
            if(c == capacity)
            {
                j++;
                c = 0;
            }
        }
        
        return lessThan(b.back(), s);
    }
};