

int integerReplacement(int n)
{
    unsigned u = n;
    int ans = 0;
    while (u != 1) {
        if (u == 3) {   // 0b11 is a special case, choose the less-zero branch
            ans += 2;
            break;
        } else if (!(u & 1)) {
            ans += __builtin_ctz(u);
            u >>= __builtin_ctz(u);
        } else {
            ans++;
            // choose the branch that has more tailing zeros
            u += (__builtin_ctz(u + 1) > __builtin_ctz(u - 1) ? 1 : -1);
        }
    }
    return ans;
}