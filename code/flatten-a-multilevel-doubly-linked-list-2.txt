class Solution {
public:
    
    void fl(Node *h, Node **p) {
        while (h) {
            Node *t = h->next;                         
            *p ? (*p)->child = NULL : 0;
            *p = (h->prev = *p) ? (*p)->next = h : h;
            h->child ? fl(h->child, p) : (void)0;
            h = t;
        }
    }
    
    Node* flatten(Node* head) {     
        Node *p = NULL;
        fl(head, &p);               
        return head;
    }
};