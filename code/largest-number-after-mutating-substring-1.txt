//char largest[strlen(num)+1]; // can't use this since this is a local variable
int i;
int have_changed = 0;
char *largest = malloc((strlen(num)+1)*sizeof(char));

strcpy(largest, num);
for (i = 0; i < strlen(num); i++)
{
    if (change[(int)num[i]-48] >= (int)num[i]-48) {
        largest[i] = (char)(change[(int)num[i]-48]+48);
        
        if (change[(int)num[i]-48] > (int)num[i]-48) {
            have_changed = 1;
        } else if (change[(int)num[i]-48] == (int)num[i]-48 && have_changed == 1) {
            have_changed = 1;
        } else if (change[(int)num[i]-48] == (int)num[i]-48 && have_changed == 0) {
            have_changed = 0;
        }
    } else if (have_changed) {
        break;
    }
}

return largest;