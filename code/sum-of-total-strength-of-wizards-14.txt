#define M 1000000007
typedef long long ll;
class Solution {
public:
    int totalStrength(vector<int>& strength) {
        stack<pair<int, int>> st;
        ll ans = 0;
        vector<ll> psum(strength.size()+2);
        for(int i = 0; i < strength.size(); i++)
            psum[i+2] = (2*psum[i+1]-psum[i]+strength[i])%M;
        st.push({-1, 1});
        strength.push_back(0);
        for(int i = 0; i < strength.size(); i++) {
            while(st.top().first >= strength[i]) {
                auto [power, k] = st.top();
                st.pop();
                auto [_1, j] = st.top();
                auto currentSum = (k*(psum[i+1]-psum[j-1])+(i+2)*(psum[j-1]-psum[k-1])+j*(psum[k-1]-psum[i+1]))%M;
                ans = (ans + currentSum * power)%M;
            }
            st.push({strength[i], i+2});
        }
        return (ans+M)%M;
    }
};