void initial(char* preorder){
    int count=0;
    int len=strlen(preorder);
    for(int i=1;i<len;i++){
       if(preorder[i]==','){
           if(preorder[i-1]=='#'){
                preorder[count++]='#';
           }else{
                preorder[count++]='1';
           }
       }
    }
    if(preorder[len-1]=='#'){
        preorder[count++]='#';
    }else{
        preorder[count++]='1';
    }
    preorder[count++]='\0';
}
bool isValidSerialization(char* preorder) {
    int len=strlen(preorder);
    if(len==1&&preorder[0]=='#'){return true;}
    if(len<5||preorder[0]=='#'){return false;}
    initial(preorder);
    len=strlen(preorder);
    int* map=(int*)calloc(len,sizeof(int));
    int count=1;
    int i=1;
    for(;i<len;i++){
        if(map[count-1]==2){
            map[count-1]=0;
            count--;
            if(count==0){
                break;
            }
            map[count-1]++;
            i--;
            continue;
        }
        if(preorder[i]!='#'){
            count++;
        }else{
            map[count-1]++;
        }
    }
    while(count>0&&map[count-1]==2){
        map[count-1]=0;
        count--;
        if(count==0){
            break;
        }
        map[count-1]++;
    }
    if(i!=len||count!=0){
        return false;
    }
    return true;
}