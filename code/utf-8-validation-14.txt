bool validUtf8(int* data, int dataSize)
{
    unsigned short bytes = 0;
    
    for (unsigned int i = 0; i < dataSize; i++)
    {
        if (bytes == 0)
        {
            if ((data[i] >> 7 & 1) == 0)
                bytes = 0; // 1 byte character
            else if (data[i] >> 6 & 1 && (data[i] >> 5 & 1) == 0)
                bytes = 1; // 2 byte character
            else if (data[i] >> 6 & 1 && data[i] >> 5 & 1 && (data[i] >> 4 & 1) == 0)
                bytes = 2; // 3 byte character
            else if (data[i] >> 6 & 1 && data[i] >> 5 & 1 && data[i] >> 4 & 1 && (data[i] >> 3 & 1) == 0)
                bytes = 3; // 4 byte character
            else
                return false;
        }
        else
        {
            if (data[i] >> 7 & 1 && (data[i] >> 6 & 1) == 0)
                bytes--;
            else
                return false;
        }
    }
    
    return bytes == 0;
}