l = lookup(key);
if (!l) {
    l = hash.head;
    i = l->key % hash.kf;
    pp = &hash.kp[i];
    while (*pp && *pp != l) {
        pp = &(*pp)->knext;
    }
    if (*pp) *pp = l->knext;
    else hash.kp[i] = NULL;
    
    l->key = key;
    i = key % hash.kf;
    l->knext = hash.kp[i];
    hash.kp[i] = l;
}

l->val = value;

move2tail(l);