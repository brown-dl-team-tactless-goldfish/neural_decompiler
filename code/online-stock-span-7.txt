struct PriceRecord
{
    int nPrice;
    short sCount;

    struct PriceRecord* pstNext;
};

typedef struct {
    struct PriceRecord* pstStock;
    struct PriceRecord* pstBuff;
} StockSpanner;

StockSpanner* stockSpannerCreate() {
    StockSpanner* pstStockSpanner = (StockSpanner*) malloc(sizeof(StockSpanner));
    pstStockSpanner->pstStock = NULL;
    pstStockSpanner->pstBuff = NULL;

    return pstStockSpanner;
}

int stockSpannerNext(StockSpanner* obj, int price) {
    if(obj->pstStock)
    {
        if(obj->pstStock->nPrice > price)
        {
            struct PriceRecord* pstNew = NULL;
            if(obj->pstBuff)
            {
                pstNew = obj->pstBuff;
                obj->pstBuff = obj->pstBuff->pstNext;
            }
            else
            {
                pstNew = (struct PriceRecord*) malloc(sizeof(struct PriceRecord));
            }

            pstNew->nPrice = price;
            pstNew->sCount = 1;
            pstNew->pstNext = obj->pstStock;

            obj->pstStock = pstNew;
        }
        else if(obj->pstStock->nPrice < price)
        {
            obj->pstStock->nPrice = price;
            obj->pstStock->sCount++;

            while(obj->pstStock->pstNext && obj->pstStock->pstNext->nPrice <= price)
            {
                obj->pstStock->sCount += obj->pstStock->pstNext->sCount;

                struct PriceRecord* pstTmp = obj->pstStock->pstNext;
                obj->pstStock->pstNext = obj->pstStock->pstNext->pstNext;
                pstTmp->pstNext = obj->pstBuff;
                obj->pstBuff = pstTmp;
            }
        }
        else
        {
            obj->pstStock->sCount++;
        }
    }
    else
    {
        if(obj->pstBuff)
        {
            struct PriceRecord* pstTmp = obj->pstBuff;
            obj->pstBuff = obj->pstBuff->pstNext;
            obj->pstStock = pstTmp;
        }
        else
        {
            obj->pstStock = (struct PriceRecord*) malloc(sizeof(struct PriceRecord));
        }

        obj->pstStock->nPrice = price;
        obj->pstStock->sCount = 1;
        obj->pstStock->pstNext = NULL;
    }

    return obj->pstStock->sCount;
}

void stockSpannerFree(StockSpanner* obj) {
    while(obj->pstStock)
    {
        struct PriceRecord* pstDel = obj->pstStock;
        obj->pstStock = obj->pstStock->pstNext;
        free(pstDel);
    }

    while(obj->pstBuff)
    {
        struct PriceRecord* pstDel = obj->pstBuff;
        obj->pstBuff = obj->pstBuff->pstNext;
        free(pstDel);
    }

    free(obj);
}

/**
 * Your StockSpanner struct will be instantiated and called as such:
 * StockSpanner* obj = stockSpannerCreate();
 * int param_1 = stockSpannerNext(obj, price);
 
 * stockSpannerFree(obj);
*/