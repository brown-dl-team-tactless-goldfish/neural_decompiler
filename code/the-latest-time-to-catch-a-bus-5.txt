class Solution {
public:
    int latestTimeCatchTheBus(vector<int>& buses, vector<int>& passengers, int capacity) {
        sort(buses.begin(), buses.end());
        sort(passengers.begin(), passengers.end());
        int n = buses.size(), m = passengers.size(), i = 0, j = 0, p = -1, ans = 0;
        while (i < n)
        {
            int t = buses[i], c = 0;
            while (j < m && passengers[j] <= t && c < capacity)
            {
                if (passengers[j] > p + 1)
                    ans = max(ans, passengers[j] - 1);
                if (passengers[j] <= t)
                    p = passengers[j];
                j++;
                c++;
            }
            if (c < capacity && p < t)
                ans = max(ans, t);
            i++;
        }
        return ans;
    }
};