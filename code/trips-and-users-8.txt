with cte as
(
    select t.request_at, status
    from Trips t
    left join Users c on t.client_id = c.users_id
    left join Users d on t.driver_id = d.users_id
    where c.banned = 'No' and d.banned = 'No' and (t.request_at between "2013-10-01" and "2013-10-03")
),
totals as
(
    select request_at, count(*) as cnt
    from cte
    group by request_at
),
canceled as
(
    select request_at, count(*) as cnt
    from cte
    where status in ('cancelled_by_driver', 'cancelled_by_client')
    group by request_at
)

select t.request_at as Day, round(coalesce(c.cnt / t.cnt, 0), 2) as "Cancellation Rate"
from totals t
left join canceled c on c.request_at = t.request_at