public class Solution 
{
    public int MaxCandies(int[] status, int[] candies, int[][] keys, int[][] containedBoxes, int[] initialBoxes) 
    {
        HashSet<int> openedBoxes = new HashSet<int>(), boxesHashSet = new HashSet<int>(initialBoxes), keysHashSet = new HashSet<int>();
        var candyCount = 0;
        while(true)
        {
            int boxCount = boxesHashSet.Count(), keyCount = keysHashSet.Count();
            foreach(var box in boxesHashSet.ToList())
            {
                if(!openedBoxes.Contains(box))
                {
                    if(status[box] == 1 || keysHashSet.Contains(box))
                    {
                        openedBoxes.Add(box);
                        candyCount += candies[box];
                        foreach(var key in keys[box])
                            keysHashSet.Add(key);
                        foreach(var b in containedBoxes[box])
                            boxesHashSet.Add(b);
                    }
                }
            }
            
            if(boxCount == boxesHashSet.Count() && keyCount == keysHashSet.Count())
                break;
        }
        
        return candyCount;
    }
}