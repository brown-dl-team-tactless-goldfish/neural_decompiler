class Solution {
    const int MAX = 1e5+4;
    int BIT[100004];
    void update(int x, int delta)
    {
      for(; x < MAX; x += x&-x)
        BIT[x] += delta;
    }
    int query(int x)
    {
        int sum = 0;
        for(; x > 0; x -= x&-x)
         sum += BIT[x];
        return sum;
    }
public:
    vector<int> countSmaller(vector<int>& nums) {
        set<int> s;
        for(int c : nums)
        {
            s.insert(c);
        }
        vector<int> snum(s.begin(),s.end());
        vector<int> ans(nums.size());
        set<int> u;
        for(int i = nums.size()-1; i >=0 ; i--)
        {
            int rank = lower_bound(snum.begin(),snum.end(),nums[i]) - snum.begin() + 1;
            ans[i] = query(rank-1);
            update(rank,1);
        }
        return ans;
    }
};