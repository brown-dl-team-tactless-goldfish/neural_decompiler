WITH c AS (
    SELECT
        id,
        visit_date,
        people,
        SUM(IF(people>=100, 1, 0)) OVER down AS consecutives_down,
        SUM(IF(people>=100, 1, 0)) OVER mid AS consecutives_mid,
        SUM(IF(people>=100, 1, 0)) OVER up AS consecutives_up
        
    FROM stadium
    WINDOW 
        up AS (ORDER BY id rows BETWEEN 0 PRECEDING AND 2 FOLLOWING), 
        down AS (ORDER BY id DESC rows BETWEEN 0 PRECEDING AND 2 FOLLOWING), 
        mid AS (ORDER BY id rows BETWEEN 1 PRECEDING AND 1 FOLLOWING)
)

SELECT
    id,
    visit_date,
    people
FROM c
WHERE 1=0
    OR consecutives_up >= 3 
    OR consecutives_down >= 3 
    OR consecutives_mid >= 3
ORDER BY id