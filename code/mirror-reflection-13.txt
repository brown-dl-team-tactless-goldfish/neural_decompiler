#define CORNER_0        0
#define CORNER_1        1
#define CORNER_2        2
#define CORNER_S        3
#define CORNER_TOTAL    4

int mirrorReflection(int p, int q){
    // get next sCorner first
    short sP = p, sQ = q, sDiff = sP % sQ;
    char cCorner = (sP/sQ) % 2? (CORNER_S+2)%CORNER_TOTAL: CORNER_S^1;
    while(sDiff)
    {
        // mirrow first and get next start & mirror cCorner
        sDiff = sQ - sDiff;
        cCorner = CORNER_S - cCorner;

        // get next sCorner & sDiff
        cCorner = (sP-sDiff)/sQ % 2? (cCorner+2)%CORNER_TOTAL: cCorner^1;
        sDiff = (sP-sDiff) % sQ;
    }

    return cCorner;
}