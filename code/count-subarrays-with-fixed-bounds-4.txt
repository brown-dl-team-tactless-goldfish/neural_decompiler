public class Solution 
{
    public long CountSubarrays(int[] nums, int minK, int maxK) 
    {
        int min = -1;
        int max = -1;
        int breaked = -1;
        long res = 0;

        for (int i = 0; i < nums.Length; i++)
        {
            if (nums[i] == minK)
            {
                min = i;
            }

            if (nums[i] == maxK)
            {
                max = i;
            }

            if (nums[i] > maxK || nums[i] < minK)
            {
                breaked = i;
            }

            var dist = Math.Min(min, max) - breaked;

            if (dist > 0)
            {
                res = res + dist;
            }
        }

        return res;
    }
}