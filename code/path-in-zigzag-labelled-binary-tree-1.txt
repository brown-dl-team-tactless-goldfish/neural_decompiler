#define LAYER_START(layer) (1 << ((layer) - 1))
#define LAYER_END(layer)   ((1 << (layer)) - 1)

int* pathInZigZagTree(int label, int* returnSize)
{
    int layer = log2(label) + 1;
    int* res = (int*)malloc(sizeof(int) * layer);
	*returnSize = layer;  
	
    int idx = label;
    if(layer % 2 == 0)
        idx = LAYER_START(layer) + LAYER_END(layer) - label;
    while(1)
    {
        res[--layer] = label;
        if(layer == 0)
            break;
        
        label = idx /= 2;
        if(layer % 2 == 0)
            label = LAYER_START(layer) + LAYER_END(layer) - idx;
    }
    
    return res;
}